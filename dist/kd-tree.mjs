"use strict";let m=class{left=null;right=null;obj;parent;dimension;constructor(c,r,s){let a=this;a.obj=c,a.parent=s,a.dimension=r}};function z(f,c,r){let s=this;function a(t,l,i){let h=l%r.length,e,n;return t.length===0?null:t.length===1?new m(t[0],h,i):(t.sort(function(g,u){return g[r[h]]-u[r[h]]}),e=Math.floor(t.length/2),n=new m(t[e],h,i),n.left=a(t.slice(0,e),l+1,n),n.right=a(t.slice(e+1),l+1,n),n)}function D(t){s.root=t;function l(i){i.left&&(i.left.parent=i,l(i.left)),i.right&&(i.right.parent=i,l(i.right))}l(s.root)}Array.isArray(f)?this.root=a(f,0,null):D(f,c,r),this.toJSON=function(t){t||(t=this.root);let l=new m(t.obj,t.dimension,null);return t.left&&(l.left=s.toJSON(t.left)),t.right&&(l.right=s.toJSON(t.right)),l},this.insert=function(t){function l(n,g){if(n===null)return g;let u=r[n.dimension];return t[u]<n.obj[u]?l(n.left,n):l(n.right,n)}let i=l(this.root,null),h,e;if(i===null){this.root=new m(t,0,null);return}h=new m(t,(i.dimension+1)%r.length,i),e=r[i.dimension],t[e]<i.obj[e]?i.left=h:i.right=h},this.remove=function(t){let l;function i(e){if(e===null)return null;if(e.obj===t)return e;let n=r[e.dimension];return t[n]<e.obj[n]?i(e.left,e):i(e.right,e)}function h(e){let n,g,u;function b(v,j){let T,F,w,o,k;return v===null?null:(T=r[j],v.dimension===j?v.left!==null?b(v.left,j):v:(F=v.obj[T],w=b(v.left,j),o=b(v.right,j),k=v,w!==null&&w.obj[T]<F&&(k=w),o!==null&&o.obj[T]<k.obj[T]&&(k=o),k))}if(e.left===null&&e.right===null){if(e.parent===null){s.root=null;return}u=r[e.parent.dimension],e.obj[u]<e.parent.obj[u]?e.parent.left=null:e.parent.right=null;return}e.right!==null?(n=b(e.right,e.dimension),g=n.obj,h(n),e.obj=g):(n=b(e.left,e.dimension),g=n.obj,h(n),e.right=e.left,e.left=null,e.obj=g)}l=i(s.root),l!==null&&h(l)},this.nearest=function(t,l,i){let h,e,n;n=new M(function(u){return-u[1]});function g(u){let b,v=r[u.dimension],j=c(t,u.obj),T={},F,w,o;function k(S,p){n.push([S,p]),n.size()>l&&n.pop()}for(o=0;o<r.length;o+=1)o===u.dimension?T[r[o]]=t[r[o]]:T[r[o]]=u.obj[r[o]];if(F=c(T,u.obj),u.right===null&&u.left===null){(n.size()<l||j<n.peek()[1])&&k(u,j);return}u.right===null?b=u.left:u.left===null?b=u.right:t[v]<u.obj[v]?b=u.left:b=u.right,g(b),(n.size()<l||j<n.peek()[1])&&k(u,j),(n.size()<l||Math.abs(F)<n.peek()[1])&&(b===u.left?w=u.right:w=u.left,w!==null&&g(w))}if(i)for(h=0;h<l;h+=1)n.push([null,i]);for(s.root&&g(s.root),e=[],h=0;h<Math.min(l,n.content.length);h+=1)n.content[h][0]&&e.push([n.content[h][0].obj,n.content[h][1]]);return e},this.balanceFactor=function(){function t(i){return i===null?0:Math.max(t(i.left),t(i.right))+1}function l(i){return i===null?0:l(i.left)+l(i.right)+1}return t(s.root)/(Math.log(l(s.root))/Math.log(2))}}function M(f){this.content=[],this.scoreFunction=f}M.prototype={push:function(f){this.content.push(f),this.bubbleUp(this.content.length-1)},pop:function(){let f=this.content[0],c=this.content.pop();return this.content.length>0&&(this.content[0]=c,this.sinkDown(0)),f},peek:function(){return this.content[0]},remove:function(f){for(let c=this.content.length,r=0;r<c;r++)if(this.content[r]==f){let s=this.content.pop();r!=c-1&&(this.content[r]=s,this.scoreFunction(s)<this.scoreFunction(f)?this.bubbleUp(r):this.sinkDown(r));return}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(f){for(let c=this.content[f];f>0;){let r=Math.floor((f+1)/2)-1,s=this.content[r];if(this.scoreFunction(c)<this.scoreFunction(s))this.content[r]=c,this.content[f]=s,f=r;else break}},sinkDown:function(f){for(let c=this.content.length,r=this.content[f],s=this.scoreFunction(r);;){let a=(f+1)*2,D=a-1,t=null;if(D<c){let l=this.content[D],i=this.scoreFunction(l);i<s&&(t=D)}if(a<c){let h=this.content[a],e=this.scoreFunction(h);e<(t==null?s:i)&&(t=a)}if(t!=null)this.content[f]=this.content[t],this.content[t]=r,f=t;else break}}};export{z as KDTree,M as KDTreeBinaryHeap};
/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @author Lumière Élevé <ble-m@ltgc.cc>, 2025
 * @author Lightingale Community https://ltgc.cc, 2025
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
