function D(f,s,r){this.obj=f,this.left=null,this.right=null,this.parent=r,this.dimension=s}function T(f,s,r){let o=this;function w(t,l,i){let h=l%r.length,n,e;return t.length===0?null:t.length===1?new D(t[0],h,i):(t.sort(function(a,u){return a[r[h]]-u[r[h]]}),n=Math.floor(t.length/2),e=new D(t[n],h,i),e.left=w(t.slice(0,n),l+1,e),e.right=w(t.slice(n+1),l+1,e),e)}function M(t){o.root=t;function l(i){i.left&&(i.left.parent=i,l(i.left)),i.right&&(i.right.parent=i,l(i.right))}l(o.root)}Array.isArray(f)?this.root=w(f,0,null):M(f,s,r),this.toJSON=function(t){t||(t=this.root);let l=new D(t.obj,t.dimension,null);return t.left&&(l.left=o.toJSON(t.left)),t.right&&(l.right=o.toJSON(t.right)),l},this.insert=function(t){function l(e,a){if(e===null)return a;let u=r[e.dimension];return t[u]<e.obj[u]?l(e.left,e):l(e.right,e)}let i=l(this.root,null),h,n;if(i===null){this.root=new D(t,0,null);return}h=new D(t,(i.dimension+1)%r.length,i),n=r[i.dimension],t[n]<i.obj[n]?i.left=h:i.right=h},this.remove=function(t){let l;function i(n){if(n===null)return null;if(n.obj===t)return n;let e=r[n.dimension];return t[e]<n.obj[e]?i(n.left,n):i(n.right,n)}function h(n){let e,a,u;function g(b,v){let j,p,k,c,F;return b===null?null:(j=r[v],b.dimension===v?b.left!==null?g(b.left,v):b:(p=b.obj[j],k=g(b.left,v),c=g(b.right,v),F=b,k!==null&&k.obj[j]<p&&(F=k),c!==null&&c.obj[j]<F.obj[j]&&(F=c),F))}if(n.left===null&&n.right===null){if(n.parent===null){o.root=null;return}u=r[n.parent.dimension],n.obj[u]<n.parent.obj[u]?n.parent.left=null:n.parent.right=null;return}n.right!==null?(e=g(n.right,n.dimension),a=e.obj,h(e),n.obj=a):(e=g(n.left,n.dimension),a=e.obj,h(e),n.right=n.left,n.left=null,n.obj=a)}l=i(o.root),l!==null&&h(l)},this.nearest=function(t,l,i){let h,n,e;e=new S(function(u){return-u[1]});function a(u){let g,b=r[u.dimension],v=s(t,u.obj),j={},p,k,c;function F(y,z){e.push([y,z]),e.size()>l&&e.pop()}for(c=0;c<r.length;c+=1)c===u.dimension?j[r[c]]=t[r[c]]:j[r[c]]=u.obj[r[c]];if(p=s(j,u.obj),u.right===null&&u.left===null){(e.size()<l||v<e.peek()[1])&&F(u,v);return}u.right===null?g=u.left:u.left===null?g=u.right:t[b]<u.obj[b]?g=u.left:g=u.right,a(g),(e.size()<l||v<e.peek()[1])&&F(u,v),(e.size()<l||Math.abs(p)<e.peek()[1])&&(g===u.left?k=u.right:k=u.left,k!==null&&a(k))}if(i)for(h=0;h<l;h+=1)e.push([null,i]);for(o.root&&a(o.root),n=[],h=0;h<Math.min(l,e.content.length);h+=1)e.content[h][0]&&n.push([e.content[h][0].obj,e.content[h][1]]);return n},this.balanceFactor=function(){function t(i){return i===null?0:Math.max(t(i.left),t(i.right))+1}function l(i){return i===null?0:l(i.left)+l(i.right)+1}return t(o.root)/(Math.log(l(o.root))/Math.log(2))}}function S(f){this.content=[],this.scoreFunction=f}S.prototype={push:function(f){this.content.push(f),this.bubbleUp(this.content.length-1)},pop:function(){let f=this.content[0],s=this.content.pop();return this.content.length>0&&(this.content[0]=s,this.sinkDown(0)),f},peek:function(){return this.content[0]},remove:function(f){for(let s=this.content.length,r=0;r<s;r++)if(this.content[r]==f){let o=this.content.pop();r!=s-1&&(this.content[r]=o,this.scoreFunction(o)<this.scoreFunction(f)?this.bubbleUp(r):this.sinkDown(r));return}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(f){for(let s=this.content[f];f>0;){let r=Math.floor((f+1)/2)-1,o=this.content[r];if(this.scoreFunction(s)<this.scoreFunction(o))this.content[r]=s,this.content[f]=o,f=r;else break}},sinkDown:function(f){for(let s=this.content.length,r=this.content[f],o=this.scoreFunction(r);;){let w=(f+1)*2,M=w-1,t=null;if(M<s){let l=this.content[M],i=this.scoreFunction(l);i<o&&(t=M)}if(w<s){let h=this.content[w],n=this.scoreFunction(h);n<(t==null?o:i)&&(t=w)}if(t!=null)this.content[f]=this.content[t],this.content[t]=r,f=t;else break}}};export{T as KDTree,S as KDTreeBinaryHeap};
/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @author Lumière Élevé <ble-m@ltgc.cc>, 2025
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
